<!-- Enhanced Fabric Quality Modal -->
<div class="modal fade" id="exampleLargeModal2" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content shadow-lg border-0 rounded-4 overflow-hidden">

      <!-- Header -->
      <div class="modal-header bg-gradient bg-primary text-white py-3 px-4">
        <div class="d-flex align-items-center">
          <i class="bi bi-card-text fs-3 me-2"></i>
          <h5 class="modal-title fw-semibold mb-0 text-white">
            Create Purchase Indent
          </h5>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Body -->
      <div class="modal-body p-4">
        <form method="POST" class="needs-validation" novalidate>
          {% csrf_token %}

          <!-- Top Fields -->
          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label class="form-label fw-semibold">Indent Date <span class="text-danger">*</span></label>
              <input type="date" class="form-control shadow-sm" name="indent_date" required>
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Department <span class="text-danger">*</span></label>
              <select name="department" class="form-select shadow-sm" required>
                <option value="" disabled selected>Select Department</option>
                <option>Production</option>
                <option>Cutting</option>
                <option>Finishing</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Priority <span class="text-danger">*</span></label>
              <select name="priority" class="form-select shadow-sm" required>
                <option value="" disabled selected>Select Priority</option>
                <option>High</option>
                <option>Medium</option>
                <option>Low</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label fw-semibold">Requested By <span class="text-danger">*</span></label>
              <input type="text" class="form-control shadow-sm" name="requested_by" required>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Required by Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control shadow-sm" name="required_date" required>
          </div>

          <!-- Items Section -->
          <div class="card border-0 shadow-sm rounded-3 mb-3">
            <div class="card-header bg-light d-flex justify-content-between align-items-center py-2 px-3">
              <h6 class="mb-0 fw-semibold">Items Required</h6>
              <button type="button" id="addItemBtn" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-plus-circle me-1"></i> Add Item
              </button>
            </div>
            <div class="table-responsive">
              <table class="table align-middle mb-0">
                <thead class="table-light">
                  <tr class="text-center">
                    <th>#</th>
                    <th>Item Description</th>
                    <th>Quantity</th>
                    <th>Unit</th>
                    <th>Remarks</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="itemsTableBody">
                  <tr class="item-row text-center">
                    <td>1</td>
                    <td>
                      <select class="form-select form-select-sm shadow-sm" name="item_description[]">
                        <option value="" selected>Select Item</option>
                        {% for i in garment %}
                        <option value="{{ i.id }}">{{ i.garment_name }}</option>
                        {% endfor %}
                      </select>
                    </td>
                    <td><input type="number" class="form-control form-control-sm shadow-sm text-center" name="quantity[]" placeholder="Qty" min="1"></td>
                    <td>
                      <select class="form-select form-select-sm shadow-sm text-center" name="unit[]">
                        <option value="" selected disabled>Select</option>
                        <option>Pcs</option>
                        <option>Kg</option>
                        <option>Meter</option>
                        <option>Liter</option>
                      </select>
                    </td>
                    <td><input type="text" class="form-control form-control-sm shadow-sm" name="remarks[]" placeholder="Remarks"></td>
                    <td>
                      <button type="button" class="btn btn-sm btn-outline-danger remove-row" disabled>
                        <i class="bx bx-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Purpose Section -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Purpose / Justification</label>
            <textarea class="form-control shadow-sm" name="purpose" rows="2" placeholder="Explain the purpose of this requisition..."></textarea>
          </div>

          <div class="text-end">
            <button type="submit" class="btn btn-primary px-4 fw-semibold shadow-sm">
              <i class="bi bi-save me-1"></i> Save
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>




<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get references to elements
    const addItemBtn = document.getElementById('addItemBtn');
    const itemsTableBody = document.getElementById('itemsTableBody');
    
    // Add event listener to the Add Item button
    addItemBtn.addEventListener('click', function() {
        // Get current number of rows
        const rowCount = itemsTableBody.querySelectorAll('tr').length;
        
        // Create a new row
        const newRow = document.createElement('tr');
        newRow.className = 'item-row text-center';
        
        // Set the HTML content for the new row
        newRow.innerHTML = `
            <td>${rowCount + 1}</td>
            <td>
                {% comment %} <input type="text" class="form-control form-control-sm" name="item_description[]" placeholder="Enter item description"> {% endcomment %}
                <select class="form-select" name="item_description[]" id="">
                  <option value="" selected>Select</option>
                  {% for i in garment %}
                  <option value="{{i.id}}">{{i.garment_name}}</option>
                  {% endfor %}
               </select>
            </td>
            <td>
                <input type="number" class="form-control form-control-sm" name="quantity[]" placeholder="Qty" min="1">
            </td>
            <td>
                <select class="form-select form-select-sm" name="unit[]">
                    <option value="" selected disabled>Select</option>
                    <option value="Pcs">Pcs</option>
                    <option value="Kg">Kg</option>
                    <option value="Meter">Meter</option>
                    <option value="Liter">Liter</option>
                </select>
            </td>
            <td>
                <input type="text" class="form-control form-control-sm" name="remarks[]" placeholder="Remarks">
            </td>
            <td>
                <button type="button" class="btn btn-sm btn-outline-danger remove-row">
                    <i class="bx bx-trash"></i>
                </button>
            </td>
        `;
        
        // Add the new row to the table
        itemsTableBody.appendChild(newRow);
        
        // Enable all remove buttons except the first one
        const removeButtons = itemsTableBody.querySelectorAll('.remove-row');
        removeButtons.forEach(button => {
            button.disabled = false;
        });
        
        // Add event listener to the new remove button
        const newRemoveButton = newRow.querySelector('.remove-row');
        newRemoveButton.addEventListener('click', function() {
            removeRow(newRow);
        });
    });
    
    // Function to remove a row
    function removeRow(row) {
        // Remove the row
        row.remove();
        
        // Update row numbers
        const rows = itemsTableBody.querySelectorAll('tr');
        rows.forEach((row, index) => {
            row.cells[0].textContent = index + 1;
        });
        
        // If only one row remains, disable its remove button
        if (rows.length === 1) {
            rows[0].querySelector('.remove-row').disabled = true;
        }
    }
    
    // Add event listeners to existing remove buttons
    const existingRemoveButtons = itemsTableBody.querySelectorAll('.remove-row');
    existingRemoveButtons.forEach(button => {
        button.addEventListener('click', function() {
            const row = this.closest('tr');
            removeRow(row);
        });
    });
});
</script>